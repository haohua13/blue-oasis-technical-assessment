<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESC-50 Dataset Web Visualization</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>ESC-50 Dataset Web Visualization</h1>
        <p>Visualize features (waveform, spectrograms, MFCCs) of environmental sound recordings from the ESC-50 dataset.</p>
        <!-- Model Status -->
        {% if model_loaded %}
        <div class="model-status loaded">✓ Trained CNN Model Loaded - Predictions Available</div>
        {% else %}
        <div class="model-status not-loaded">⚠ Model not loaded - Train the model first to see predictions</div>
        {% endif %}
         <section class="form-section">
            <h2>Explore a Sample from ESC-50</h2>
            <p>Select a category, optionally a fold or file name, and visualize its extracted features and CNN prediction (if available).</p>
            <form id="audioForm">
                <div class="input-group">
                    <label for="categorySelect">Category:</label>
                    <select id="categorySelect" name="category_name">
                        <option value="">-- Select Category --</option>
                        {% for category in categories %}
                        <option value="{{ category }}">{{ category }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="input-group">
                    <label for="foldSelect">Fold:</label>
                    <select id="foldSelect" name="fold">
                        <option value="all">All</option>
                        {% for f in folds %}
                        <option value="{{ f }}">{{ f }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="input-group">
                    <label for="fileIdInput">Specific File ID:</label>
                    <input type="text" id="fileIdInput" name="file_id" placeholder="e.g. 1-100032-A-0.wav">
                </div>

                <div class="input-actions">
                    <button type="submit">Explore</button>
                </div>
            </form>
        </section>

        <div id="loading" style="display: none;">Loading audio and features...</div>
        <div id="error" class="error-box" style="display: none;"></div>

        <section id="results" style="display: none;">
            <h2>Data</h2>
            <p><strong>File:</strong> <span id="displayFileId"></span><br>
               <strong>Category:</strong> <span id="displayClass"></span><br>
               <strong>Fold:</strong> <span id="displayFold"></span><br>
               <strong>Duration:</strong> <span id="displayDuration"></span> |
               <strong>Sample Rate:</strong> <span id="displaySampleRate"></span>
            </p>

            <div class="audio-player">
                <h3>Audio Player</h3>
                <audio controls id="audioPlayer"></audio>
            </div>

            <div class="plot-section">
                <h3>Waveform</h3>
                <img id="waveformImage" src="" alt="Waveform Plot">
            </div>

            <div class="plot-section">
                <h3>Mel Spectrogram</h3>
                <img id="melSpectrogramImage" src="" alt="Mel Spectrogram">
            </div>

            <div class="plot-section">
                <h3>MFCCs</h3>
                <img id="mfccImage" src="" alt="MFCCs Plot">
            </div>

            <div class="plot-section">
                <h3>Zero-Crossing Rate</h3>
                <img id="zcrImage" src="" alt="ZCR Plot">
            </div>

            <div id="predictionResults" style="display: none;">
                <h3>CNN Prediction</h3>
                <p><strong>Predicted:</strong> <span id="predictedClass"></span><br>
                   <strong>Confidence:</strong> <span id="predictedConfidence"></span>%</p>
                <h4>Top 5 Class Predictions:</h4>
                <ul id="topPredictionsList"></ul>
            </div>
        </section>

        <section class="compare-section">
            <h2>Compare Samples</h2>
            <p>This feature lets you compare several random samples from the same sound category. Useful for exploring within-class variation of the CNN performance.</p>
            <form id="compareForm">
                <div class="input-group">
                    <label for="compareCategory">Category:</label>
                    <select id="compareCategory" name="category_name">
                        {% for category in categories %}
                        <option value="{{ category }}">{{ category }}</option>
                        {% endfor %}
                    </select>
                    <label for="foldCompare">Fold:</label>
                    <select id="foldCompare" name="fold">
                        <option value="all">All</option>
                        {% for f in folds %}
                        <option value="{{ f }}">{{ f }}</option>
                        {% endfor %}
                    </select>
                    <label for="numSamples">Number of Samples:</label>
                    <input type="number" id="numSamples" name="num_samples" min="1" max="5" value="1">
                    <button type="submit">Compare</button>
                </div>
            </form>
            <div id="compareResults"></div>
        </section>

        <section class="stats-section">
            <h2>Dataset Statistics</h2>
            <p>Displays basic information about the ESC-50 dataset, such as total samples, number of classes, and class distribution.
                In this case the dataset is balanced so not very interesting...
            </p>
            <button id="loadStats">Show Statistics</button>
            <div id="statsOutput"></div>
        </section>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>